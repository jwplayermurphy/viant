<!DOCTYPE html>
<html>
<head>

<script
  src="js/jquery-3.2.1.min.js">  	
</script>
<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script src="codemirror-5.30.0/lib/codemirror.js"></script>
<link rel="stylesheet" href="codemirror-5.30.0/lib/codemirror.css">
<script src="codemirror-5.30.0/mode/javascript/javascript.js"></script> 
<!--  <script src="https://imasdk.googleapis.com/js/sdkloader/ima3_debug.js"></script> -->
<script type="text/javascript" src="js/jw.js"></script>
<link rel="stylesheet" type="text/css" href="css/main.css">

</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-12">
				<h2>JW Player Offline/Local Playback Demo</h2>
			</div>
		</div>
		<div class="row">
			<div class="col-md-6">
				<div id="jw"></div>
			</div>
			<div class="col-md-6" id="codemirror">
			</div>
		</div>
		<div class="row">
			<div class="col-md-6" id="refresh">
				<button onclick="refreshPlayer()" class="btn btn-primary">Update Player</button>
				<button onclick="clearLocalStorage()" class="btn btn-primary">Reset Player</button>
			</div>
		</div>
	</div>
</body>
<script>
	if (typeof(Storage) !== "undefined") {
    // Code for localStorage/sessionStorage
    	if(localStorage.jwplayer){

    		var myLocalElement = localStorage.jwplayer;

    	}
    	else{

    		var myLocalElement = "jwplayer('jw').setup({%	file: 'video.mp4',%	image: 'image.png'%});%%obj = jwplayer().getConfig();%str = JSON.stringify(obj, null, 4);%console.log(str);";
    	}
	} else {
    // Sorry! No Web Storage support..

    	var myLocalElement = "jwplayer('jw').setup({%	file: 'video.mp4,%	image: 'image.png'%});%%obj = jwplayer().getConfig();%str = JSON.stringify(obj, null, 4);%console.log(str);";

    	console.log("No Support for localStorage. Try Chrome - it's better for these things :)")
	}


var myCodeMirror = CodeMirror(document.getElementById('codemirror'), {
  value: myLocalElement,
  mode:  "javascript",
  lineNumbers: true,
  json: true,
  lineSeparator: "%",
  indentUnit: 4
});

function refreshPlayer() {

	jwplayer("jw").remove();
	console.clear();

	var myString = myCodeMirror.getValue();
	localStorage.jwplayer = myString;
	var cleanValue = myString.replace(/%/g, '');
	eval(cleanValue);

}

function clearLocalStorage(){

	if(localStorage.jwplayer){
		localStorage.removeItem("jwplayer");
		location.reload();
	}
	else{

		location.reload();
	}

}

refreshPlayer();


</script>
</html>
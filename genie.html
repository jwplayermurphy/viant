<!DOCTYPE html>
<html>
<head>

</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-12">
				<h2>Dynamic Ad Playback from JSON Playlist</h2>
				<hr>
			</div>
		</div>
		<div class="row" style="max-width: 50%">
			<div class="col-md-6">	
				<!-- Begin JW Player Embed Code Here -->
				<div id="jwplayer_video_container"></div>
				<script type="text/javascript" src="https://content.jwplatform.com/libraries/PjDyt66d.js"></script>
				<script>
				function buildJW(jwplayer, playlist_url){
					jw = jwplayer("jwplayer_video_container");
					var xmlhttp = new XMLHttpRequest();
					xmlhttp.onreadystatechange = function() {
					    if (this.readyState == 4 && this.status == 200) {
					        var myObj = JSON.parse(this.responseText);
					        //pick a random video in our array
					        var arr_length = myObj.playlist.length - 1;
					        var rand_int = Math.floor(Math.random() * (arr_length - 0 + 1)) + 0;
					        //get source file from playlist object
					        var file = myObj.playlist[rand_int].sources[0].file;
					        //get tags to map to our ad tag
					        var tags = myObj.playlist[rand_int].tags;
					        //use mediaid to append to tracking pixels for parity
					        var mediaid = myObj.playlist[rand_int].mediaid;
					        //get all tags as an array
					        var tags_array = tags.split(",");
					        for(var i = 0; i <= arr_length; i++){
					        	var tag = tags_array[i];
					        	if(myObj.hasOwnProperty(tag)){
					        		jw.setup({	
										file: file,
										advertising: {
											client: "vast",
											tag: myObj[tag]
										}
										//,mute:true
										//,autostart:true
										//pubs/networks can add to this
									});
									//end our for loop
					        		i = arr_length + 1;
					        		//pubs and networks can listen for events
					        		//add custom code here by binding to jw
					        		//https://developer.jwplayer.com/jw-player/docs/javascript-api-reference/
					        		jw.on("firstFrame", function(){
					        			console.log("I am working!")
					        		});
					        		jw.on("ready", function(){
					        			console.log("I am ready!")
					        		});
					        		jw.on("adError", function(){
					        			//if we can't run the add, remove the player
					        			//jw.remove();
					        			//add your code to build a 2nd player
					        		});
					        	}
					        	else{
					        		console.log("false, no campaign using: " + tag)
					        	}
					        }
					    }
					};
					xmlhttp.open("GET", playlist_url, true);
					xmlhttp.send();	
				}
				buildJW(jwplayer, "https://cdn.jwplayer.com/v2/playlists/Hhg78iLp");
				</script>
				<!-- End JW Player Embed Code Here -->
			</div>
		</div>
	</div>
</body>
</html>